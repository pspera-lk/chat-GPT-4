<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT 4 - Advanced AI Chat</title>
    <meta name="description" content="Advanced ChatGPT 4 web application with live typing, chat history, and modern design">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations and styles */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }

        .animate-slideDown {
            animation: slideDown 0.3s ease-out;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Ensure proper text rendering */
        body {
            font-feature-settings: "rlig" 1, "calt" 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Lucide Icons */
        .lucide {
            width: 1em;
            height: 1em;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Lucide Icons Components
        const MessageSquare = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="m3 6 3 0"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <path d="m19 6-1 0"/>
                <path d="M10 11v6"/>
                <path d="m14 11 0 6"/>
                <path d="m18 6-2 16-8 0L6 6"/>
            </svg>
        );

        const Search = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
        );

        const Send = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="m22 2-7 20-4-9-9-4Z"/>
                <path d="M22 2 11 13"/>
            </svg>
        );

        const Loader2 = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        const User = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const Bot = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M12 8V4H8"/>
                <rect width="16" height="12" x="4" y="8" rx="2"/>
                <path d="M2 14h2"/>
                <path d="M20 14h2"/>
                <path d="M15 13v2"/>
                <path d="M9 13v2"/>
            </svg>
        );

        const Copy = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
            </svg>
        );

        const Check = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <polyline points="20,6 9,17 4,12"/>
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="m18 6-12 12"/>
                <path d="m6 6 12 12"/>
            </svg>
        );

        const AlertCircle = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );

        const RefreshCw = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                <path d="M3 21v-5h5"/>
            </svg>
        );

        const Sparkles = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                <path d="M5 3v4"/>
                <path d="M19 17v4"/>
                <path d="M3 5h4"/>
                <path d="M17 19h4"/>
            </svg>
        );

        const Zap = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
            </svg>
        );

        const Globe = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
        );

        const ExternalLink = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15,3 21,3 21,9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
        );

        const CheckCircle = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        );

        const Circle = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
            </svg>
        );

        const Quote = ({ size = 24, className = "" }) => (
            <svg className={`lucide ${className}`} width={size} height={size} viewBox="0 0 24 24">
                <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/>
                <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/>
            </svg>
        );

        // Storage utilities
        const STORAGE_KEY = 'chatgpt-messages';

        const saveMessages = (messages) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
            } catch (error) {
                console.error('Failed to save messages to localStorage:', error);
            }
        };

        const loadMessages = () => {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    return parsed.map((msg) => ({
                        ...msg,
                        timestamp: new Date(msg.timestamp)
                    }));
                }
            } catch (error) {
                console.error('Failed to load messages from localStorage:', error);
            }
            return [];
        };

        const clearMessages = () => {
            try {
                localStorage.removeItem(STORAGE_KEY);
            } catch (error) {
                console.error('Failed to clear messages from localStorage:', error);
            }
        };

        // API utility
        const chatGPTAPI = async (query) => {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                const response = await fetch(
                    `/?q=${encodeURIComponent(query)}`,
                    {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json',
                        },
                    }
                );
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('Rate limit exceeded. Please wait a moment before trying again.');
                    } else if (response.status >= 500) {
                        throw new Error('The ChatGPT service is temporarily unavailable. Please try again later.');
                    } else if (response.status === 403) {
                        throw new Error('Access denied. The API key may be invalid or expired.');
                    } else {
                        throw new Error(`API request failed with status ${response.status}. Please try again.`);
                    }
                }
                
                const data = await response.json();
                
                if (data.success && data.result && data.result.message) {
                    return data.result.message;
                } else {
                    throw new Error('Invalid response format from ChatGPT API.');
                }
                
            } catch (error) {
                console.error('ChatGPT API Error:', error);
                
                if (error instanceof Error) {
                    if (error.name === 'AbortError') {
                        throw new Error('Request timed out. Please check your internet connection and try again.');
                    } else if (error.message.includes('Failed to fetch')) {
                        throw new Error('Unable to connect to ChatGPT service. Please check your internet connection or try again later. The service may be temporarily unavailable.');
                    } else if (error.message.includes('CORS')) {
                        throw new Error('Connection blocked by browser security. The ChatGPT service may not be properly configured for web access.');
                    } else {
                        throw error;
                    }
                }
                
                throw new Error('An unexpected error occurred while connecting to ChatGPT. Please try again.');
            }
        };

        // Custom hook for chat functionality
        const useChat = () => {
            const [state, setState] = useState({
                messages: [],
                isLoading: false,
                error: null,
            });

            useEffect(() => {
                const savedMessages = loadMessages();
                setState(prev => ({ ...prev, messages: savedMessages }));
            }, []);

            useEffect(() => {
                if (state.messages.length > 0) {
                    saveMessages(state.messages);
                }
            }, [state.messages]);

            const sendMessage = useCallback(async (content) => {
                if (!content.trim()) return;

                const userMessage = {
                    id: Date.now().toString(),
                    content: content.trim(),
                    role: 'user',
                    timestamp: new Date(),
                };

                setState(prev => ({
                    ...prev,
                    messages: [...prev.messages, userMessage],
                    isLoading: true,
                    error: null,
                }));

                try {
                    const response = await chatGPTAPI(content.trim());
                    
                    const assistantMessage = {
                        id: (Date.now() + 1).toString(),
                        content: response,
                        role: 'assistant',
                        timestamp: new Date(),
                    };

                    setState(prev => ({
                        ...prev,
                        messages: [...prev.messages, assistantMessage],
                        isLoading: false,
                    }));
                } catch (error) {
                    setState(prev => ({
                        ...prev,
                        isLoading: false,
                        error: error instanceof Error ? error.message : 'An unexpected error occurred',
                    }));
                }
            }, []);

            const clearChat = useCallback(() => {
                setState(prev => ({
                    ...prev,
                    messages: [],
                    error: null,
                }));
                clearMessages();
            }, []);

            const retryLastMessage = useCallback(() => {
                const lastUserMessage = [...state.messages].reverse().find(msg => msg.role === 'user');
                if (lastUserMessage) {
                    setState(prev => ({
                        ...prev,
                        messages: prev.messages.filter(msg => msg.role !== 'assistant' || msg.content !== prev.error),
                        error: null,
                    }));
                    sendMessage(lastUserMessage.content);
                }
            }, [state.messages, sendMessage]);

            return {
                messages: state.messages,
                isLoading: state.isLoading,
                error: state.error,
                sendMessage,
                clearChat,
                retryLastMessage,
            };
        };

        // Components
        const CodeBlock = ({ code, language }) => {
            const [copied, setCopied] = useState(false);

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(code);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (error) {
                    console.error('Failed to copy code:', error);
                }
            };

            const getLanguageColor = (lang) => {
                const colors = {
                    javascript: 'text-yellow-600',
                    js: 'text-yellow-600',
                    typescript: 'text-blue-600',
                    ts: 'text-blue-600',
                    python: 'text-green-600',
                    py: 'text-green-600',
                    html: 'text-orange-600',
                    css: 'text-purple-600',
                    json: 'text-gray-600',
                    bash: 'text-gray-800',
                    shell: 'text-gray-800',
                    sql: 'text-indigo-600',
                    java: 'text-red-600',
                    cpp: 'text-blue-800',
                    'c++': 'text-blue-800',
                    c: 'text-blue-700',
                    php: 'text-purple-700',
                    ruby: 'text-red-500',
                    go: 'text-cyan-600',
                    rust: 'text-orange-700',
                    swift: 'text-orange-500',
                    kotlin: 'text-purple-500',
                };
                return colors[lang.toLowerCase()] || 'text-gray-600';
            };

            return (
                <div className="my-4 bg-gray-900 border border-gray-700 rounded-lg overflow-hidden shadow-lg">
                    <div className="flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700">
                        <div className="flex items-center space-x-3">
                            <div className="flex space-x-1.5">
                                <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                                <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                            </div>
                            <span className={`text-sm font-medium ${getLanguageColor(language)}`}>
                                {language}
                            </span>
                        </div>
                        <button
                            onClick={handleCopy}
                            className="flex items-center space-x-2 px-3 py-1.5 text-xs text-gray-300 hover:text-white hover:bg-gray-700 rounded-md transition-colors duration-200 border border-gray-600 hover:border-gray-500"
                            title="Copy code"
                        >
                            {copied ? (
                                <>
                                    <Check size={14} className="text-green-400" />
                                    <span className="text-green-400">Copied!</span>
                                </>
                            ) : (
                                <>
                                    <Copy size={14} />
                                    <span>Copy</span>
                                </>
                            )}
                        </button>
                    </div>
                    
                    <div className="relative">
                        <pre className="p-4 overflow-x-auto text-sm leading-relaxed">
                            <code className="text-gray-100 font-mono whitespace-pre">
                                {code}
                            </code>
                        </pre>
                        
                        <div className="absolute left-0 top-0 p-4 text-gray-500 text-sm font-mono leading-relaxed select-none pointer-events-none">
                            {code.split('\n').map((_, index) => (
                                <div key={index} className="text-right pr-4 min-w-[2rem]">
                                    {index + 1}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const MessageRenderer = ({ content, isUser }) => {
            const parseContent = (text) => {
                const elements = [];
                let currentIndex = 0;

                const patterns = [
                    { regex: /```(\w+)?\s*\n?([\s\S]*?)```/g, type: 'codeblock' },
                    { regex: /```([^`\n]+)```/g, type: 'inlinecodeblock' },
                    { regex: /\*\*(.*?)\*\*/g, type: 'bold' },
                    { regex: /(?<!\*)\*([^*\n]+)\*(?!\*)/g, type: 'italic' },
                    { regex: /`([^`\n]+)`/g, type: 'inlinecode' },
                    { regex: /(https?:\/\/[^\s<>"{}|\\^`[\]]+)/g, type: 'link' },
                ];

                const matches = [];

                patterns.forEach(pattern => {
                    let match;
                    const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
                    while ((match = regex.exec(text)) !== null) {
                        matches.push({
                            match,
                            type: pattern.type,
                            start: match.index,
                            end: match.index + match[0].length,
                        });
                    }
                });

                matches.sort((a, b) => a.start - b.start);

                const filteredMatches = matches.filter((match, index) => {
                    for (let i = 0; i < matches.length; i++) {
                        if (i === index) continue;
                        const otherMatch = matches[i];
                        
                        if (match.start < otherMatch.end && match.end > otherMatch.start) {
                            if (otherMatch.match[0].length > match.match[0].length || 
                                (otherMatch.match[0].length === match.match[0].length && i < index)) {
                                return false;
                            }
                        }
                    }
                    return true;
                });

                filteredMatches.sort((a, b) => a.start - b.start);

                filteredMatches.forEach((matchInfo, index) => {
                    const { match, type, start, end } = matchInfo;

                    if (start > currentIndex) {
                        const textBefore = text.slice(currentIndex, start);
                        if (textBefore.trim()) {
                            elements.push(
                                React.createElement('span', {
                                    key: `text-${index}-before`,
                                    className: "whitespace-pre-wrap"
                                }, textBefore)
                            );
                        }
                    }

                    elements.push(renderElement(match, type, index, isUser));
                    currentIndex = end;
                });

                if (currentIndex < text.length) {
                    const remainingText = text.slice(currentIndex);
                    if (remainingText.trim()) {
                        elements.push(
                            React.createElement('span', {
                                key: "text-remaining",
                                className: "whitespace-pre-wrap"
                            }, remainingText)
                        );
                    }
                }

                return elements.length > 0 ? elements : [
                    React.createElement('span', {
                        key: "default",
                        className: "whitespace-pre-wrap"
                    }, text)
                ];
            };

            const renderElement = (match, type, index, isUser) => {
                switch (type) {
                    case 'codeblock':
                        const language = match[1] || 'text';
                        const code = match[2] || match[0].replace(/```[\w]*\s*\n?/, '').replace(/```$/, '');
                        return React.createElement(CodeBlock, {
                            key: `code-${index}`,
                            code: code.trim(),
                            language: language
                        });

                    case 'inlinecodeblock':
                        const singleLineCode = match[1] || match[0].replace(/```/g, '');
                        return React.createElement(CodeBlock, {
                            key: `code-${index}`,
                            code: singleLineCode.trim(),
                            language: "text"
                        });

                    case 'bold':
                        return React.createElement('strong', {
                            key: `bold-${index}`,
                            className: "font-bold"
                        }, match[1]);

                    case 'italic':
                        return React.createElement('em', {
                            key: `italic-${index}`,
                            className: "italic"
                        }, match[1]);

                    case 'inlinecode':
                        return React.createElement('code', {
                            key: `inline-${index}`,
                            className: `px-2 py-1 rounded-md text-sm font-mono ${
                                isUser 
                                    ? 'bg-blue-400 bg-opacity-30 text-blue-100' 
                                    : 'bg-gray-800 text-green-400 border border-gray-700'
                            }`
                        }, match[1]);

                    case 'link':
                        const getDomain = (url) => {
                            try {
                                return new URL(url).hostname;
                            } catch {
                                return url;
                            }
                        };

                        return React.createElement('a', {
                            key: `link-${index}`,
                            href: match[0],
                            target: "_blank",
                            rel: "noopener noreferrer",
                            className: `inline-flex items-center space-x-1 px-2 py-1 rounded-md transition-colors duration-200 ${
                                isUser
                                    ? 'text-blue-200 hover:text-white hover:bg-blue-400 hover:bg-opacity-30'
                                    : 'text-blue-600 hover:text-blue-800 hover:bg-blue-50'
                            }`
                        }, [
                            React.createElement('span', {
                                key: 'domain',
                                className: "text-sm underline"
                            }, getDomain(match[0])),
                            React.createElement(ExternalLink, { key: 'icon', size: 12 })
                        ]);

                    default:
                        return React.createElement('span', {
                            key: `default-${index}`
                        }, match[0]);
                }
            };

            return React.createElement('div', {
                className: "space-y-2"
            }, parseContent(content));
        };

        const ChatMessage = ({ message, isLatest = false }) => {
            const [copied, setCopied] = useState(false);

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(message.content);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (error) {
                    console.error('Failed to copy text:', error);
                }
            };

            const isUser = message.role === 'user';

            return (
                <div className={`flex ${isUser ? 'justify-end' : 'justify-start'} mb-6 animate-fadeIn`}>
                    <div className={`flex ${isUser ? 'flex-row-reverse' : 'flex-row'} items-start max-w-[90%] gap-3`}>
                        <div className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${
                            isUser 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-600' 
                                : 'bg-gradient-to-r from-green-500 to-teal-600'
                        }`}>
                            {isUser ? <User size={20} className="text-white" /> : <Bot size={20} className="text-white" />}
                        </div>

                        <div className={`relative group ${
                            isUser 
                                ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white' 
                                : 'bg-white border border-gray-200 text-gray-900'
                        } rounded-2xl px-4 py-3 shadow-lg max-w-full overflow-hidden`}>
                            
                            <div className="text-sm leading-relaxed break-words">
                                <MessageRenderer content={message.content} isUser={isUser} />
                            </div>

                            <div className={`text-xs mt-3 ${
                                isUser ? 'text-blue-200' : 'text-gray-500'
                            }`}>
                                {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                            </div>

                            {!isUser && (
                                <button
                                    onClick={handleCopy}
                                    className="absolute -right-2 -top-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-gray-100 hover:bg-gray-200 rounded-full p-2 shadow-md"
                                    title="Copy message"
                                >
                                    {copied ? (
                                        <Check size={14} className="text-green-600" />
                                    ) : (
                                        <Copy size={14} className="text-gray-600" />
                                    )}
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ChatInput = ({ onSendMessage, isLoading, placeholder = "Type your message here..." }) => {
            const [message, setMessage] = useState('');
            const textareaRef = useRef(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (message.trim() && !isLoading) {
                    onSendMessage(message);
                    setMessage('');
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSubmit(e);
                }
            };

            useEffect(() => {
                if (textareaRef.current) {
                    textareaRef.current.style.height = 'auto';
                    textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`;
                }
            }, [message]);

            return (
                <div className="border-t border-gray-200 bg-white p-4">
                    <form onSubmit={handleSubmit} className="flex items-end gap-3">
                        <div className="flex-1 relative">
                            <textarea
                                ref={textareaRef}
                                value={message}
                                onChange={(e) => setMessage(e.target.value)}
                                onKeyDown={handleKeyDown}
                                placeholder={placeholder}
                                disabled={isLoading}
                                rows={1}
                                className="w-full px-4 py-3 pr-12 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none max-h-32 disabled:opacity-50 disabled:cursor-not-allowed"
                            />
                            <div className="absolute right-3 bottom-3 text-xs text-gray-400">
                                {message.length > 0 && `${message.length} chars`}
                            </div>
                        </div>
                        
                        <button
                            type="submit"
                            disabled={!message.trim() || isLoading}
                            className="flex items-center justify-center w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full hover:from-blue-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl"
                        >
                            {isLoading ? (
                                <Loader2 size={20} className="animate-spin" />
                            ) : (
                                <Send size={20} />
                            )}
                        </button>
                    </form>
                </div>
            );
        };

        const ChatHeader = ({ messageCount, onClearChat, onToggleSearch, showSearch }) => {
            return (
                <div className="bg-white border-b border-gray-200 px-6 py-4">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <div className="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                <MessageSquare size={20} className="text-white" />
                            </div>
                            <div>
                                <h1 className="text-xl font-semibold text-gray-900">ChatGPT 4</h1>
                                <p className="text-sm text-gray-500">
                                    {messageCount === 0 ? 'Start a conversation' : `${Math.floor(messageCount / 2)} messages`}
                                </p>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-2">
                            <button
                                onClick={onToggleSearch}
                                className={`p-2 rounded-lg transition-colors duration-200 ${
                                    showSearch 
                                        ? 'bg-blue-100 text-blue-600' 
                                        : 'text-gray-500 hover:bg-gray-100'
                                }`}
                                title="Search messages"
                            >
                                <Search size={20} />
                            </button>
                            
                            {messageCount > 0 && (
                                <button
                                    onClick={onClearChat}
                                    className="p-2 text-gray-500 hover:bg-red-50 hover:text-red-600 rounded-lg transition-colors duration-200"
                                    title="Clear chat history"
                                >
                                    <Trash2 size={20} />
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const SearchBar = ({ searchTerm, onSearchChange, onClose, resultCount }) => {
            return (
                <div className="bg-blue-50 border-b border-blue-200 px-6 py-3 animate-slideDown">
                    <div className="flex items-center space-x-3">
                        <Search size={20} className="text-blue-600" />
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={(e) => onSearchChange(e.target.value)}
                            placeholder="Search messages..."
                            className="flex-1 bg-transparent border-none outline-none text-gray-900 placeholder-gray-500"
                            autoFocus
                        />
                        {searchTerm && (
                            <span className="text-sm text-blue-600">
                                {resultCount} result{resultCount !== 1 ? 's' : ''}
                            </span>
                        )}
                        <button
                            onClick={onClose}
                            className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                        >
                            <X size={16} />
                        </button>
                    </div>
                </div>
            );
        };

        const TypingIndicator = () => {
            return (
                <div className="flex items-center space-x-1 p-4">
                    <div className="flex space-x-1">
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                    </div>
                    <span className="text-sm text-gray-500 ml-2">ChatGPT is typing...</span>
                </div>
            );
        };

        const ErrorMessage = ({ error, onRetry }) => {
            return (
                <div className="flex justify-center mb-6">
                    <div className="bg-red-50 border border-red-200 rounded-lg p-4 max-w-md">
                        <div className="flex items-center space-x-3">
                            <AlertCircle size={20} className="text-red-500 flex-shrink-0" />
                            <div className="flex-1">
                                <p className="text-sm text-red-700">{error}</p>
                                <button
                                    onClick={onRetry}
                                    className="mt-2 flex items-center space-x-1 text-xs text-red-600 hover:text-red-800"
                                >
                                    <RefreshCw size={12} />
                                    <span>Retry</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const EmptyState = ({ onStartChat }) => {
            const suggestions = [
                {
                    icon: <Sparkles className="text-purple-600" size={20} />,
                    title: "Creative Writing",
                    prompt: "Help me write a creative story about space exploration"
                },
                {
                    icon: <Zap className="text-yellow-600" size={20} />,
                    title: "Problem Solving",
                    prompt: "Explain quantum computing in simple terms"
                },
                {
                    icon: <Globe className="text-blue-600" size={20} />,
                    title: "Learning",
                    prompt: "Teach me about sustainable energy sources"
                }
            ];

            return (
                <div className="flex-1 flex items-center justify-center p-8">
                    <div className="max-w-2xl text-center">
                        <div className="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                            <MessageSquare size={32} className="text-white" />
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            Welcome to ChatGPT 4
                        </h2>
                        
                        <p className="text-lg text-gray-600 mb-8">
                            Start a conversation with advanced AI. Ask questions, get creative help, or explore new topics.
                        </p>

                        <div className="grid md:grid-cols-3 gap-4 mb-8">
                            {suggestions.map((suggestion, index) => (
                                <button
                                    key={index}
                                    onClick={() => onStartChat(suggestion.prompt)}
                                    className="p-4 bg-white border border-gray-200 rounded-xl hover:border-blue-300 hover:shadow-md transition-all duration-200 text-left group"
                                >
                                    <div className="flex items-center space-x-3 mb-2">
                                        {suggestion.icon}
                                        <span className="font-medium text-gray-900">{suggestion.title}</span>
                                    </div>
                                    <p className="text-sm text-gray-600 group-hover:text-gray-800">
                                        {suggestion.prompt}
                                    </p>
                                </button>
                            ))}
                        </div>

                        <div className="text-sm text-gray-500">
                            <p>Tips: Use Shift + Enter for new lines, or simply press Enter to send</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const { messages, isLoading, error, sendMessage, clearChat, retryLastMessage } = useChat();
            const [showSearch, setShowSearch] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages, isLoading]);

            const filteredMessages = searchTerm
                ? messages.filter(msg => 
                    msg.content.toLowerCase().includes(searchTerm.toLowerCase())
                  )
                : messages;

            const handleClearChat = () => {
                if (window.confirm('Are you sure you want to clear all messages?')) {
                    clearChat();
                    setShowSearch(false);
                    setSearchTerm('');
                }
            };

            const handleToggleSearch = () => {
                setShowSearch(!showSearch);
                if (showSearch) {
                    setSearchTerm('');
                }
            };

            return (
                <div className="flex flex-col h-screen bg-gradient-to-br from-gray-50 to-blue-50">
                    <ChatHeader
                        messageCount={messages.length}
                        onClearChat={handleClearChat}
                        onToggleSearch={handleToggleSearch}
                        showSearch={showSearch}
                    />

                    {showSearch && (
                        <SearchBar
                            searchTerm={searchTerm}
                            onSearchChange={setSearchTerm}
                            onClose={handleToggleSearch}
                            resultCount={filteredMessages.length}
                        />
                    )}

                    <div className="flex-1 overflow-y-auto">
                        {messages.length === 0 ? (
                            <EmptyState onStartChat={sendMessage} />
                        ) : (
                            <div className="max-w-4xl mx-auto px-4 py-6">
                                {filteredMessages.map((message, index) => (
                                    <ChatMessage
                                        key={message.id}
                                        message={message}
                                        isLatest={index === filteredMessages.length - 1}
                                    />
                                ))}
                                
                                {isLoading && <TypingIndicator />}
                                
                                {error && (
                                    <ErrorMessage error={error} onRetry={retryLastMessage} />
                                )}
                                
                                <div ref={messagesEndRef} />
                            </div>
                        )}
                    </div>

                    <ChatInput
                        onSendMessage={sendMessage}
                        isLoading={isLoading}
                        placeholder="Ask ChatGPT anything..."
                    />
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
